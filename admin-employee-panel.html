<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Manage Employees</title>
  <style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
    background: #f4f4f4;
    margin: 0;
  }

  h1, h2, h3 {
    color: #002244;
  }

  .header {
    background-color: #002244;
    color: white;
    padding: 15px;
    text-align: center;
    border-radius: 0 0 15px 15px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }

  .form-section {
    background: white;
    padding: 30px;
    border-radius: 20px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    margin-top: 20px;
  }

  input[type="text"],
  input[type="date"],
  input[type="password"] {
    padding: 10px;
    margin: 8px 10px 8px 0;
    border: 1px solid #ccc;
    border-radius: 12px;
    width: calc(30% - 12px);
    min-width: 200px;
    box-sizing: border-box;
    transition: 0.3s ease;
  }

  input:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 5px #007bff55;
  }

  label {
    display: block;
    margin-top: 12px;
    font-weight: bold;
  }

  button {
    padding: 10px 18px;
    border: none;
    border-radius: 20px;
    cursor: pointer;
    margin: 8px 5px;
    transition: 0.3s ease;
    font-weight: bold;
  }

  button:hover {
    opacity: 0.85;
  }

  button.action-btn {
    background-color: #dc3545;
    color: white;
  }

  button.action-btn.edit {
    background-color: #007bff;
  }

  button[type="submit"],
  .form-section button {
    background-color: #28a745;
    color: white;
  }

  table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    background: white;
    border-radius: 12px;
    overflow: hidden;
    margin-top: 25px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
  }

  th, td {
    padding: 12px 10px;
    border-bottom: 1px solid #ccc;
    text-align: center;
  }

  th {
    background: #002244;
    color: white;
  }

  tr:last-child td {
    border-bottom: none;
  }

  .button-rounded {
    border-radius: 25px;
    padding: 8px 16px;
    cursor: pointer;
    border: none;
    background-color: #007bff;
    color: white;
  }

  @media screen and (max-width: 768px) {
    input[type="text"],
    input[type="date"],
    input[type="password"] {
      width: 100%;
      margin-right: 0;
    }
  }
</style>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css">

</head>
<body>
  <div class="header">
    <h2>Employee Management Panel (Temporary)</h2>
  </div>
 <button onclick="goBack()" style="
    position: absolute;
    top: 25px;
    left: 20px;
    width: 55px;
    height: 55px;
    background-color: #ffbb00;
    color: white;
    border: none;
    border-radius: 50%;
    font-size: 40px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  ">
    <i class="fa-solid fa-arrow-left"></i>
  </button>

  <div class="form-section">
    <h3>Add / Edit Employee</h3>
    <input type="hidden" id="employeeId">
    <input type="text" id="name" placeholder="Name">
    <input type="text" id="employee_id" placeholder="Employee ID (e.g., E001)">

    <input type="text" id="designation" placeholder="Designation">
    <input type="text" id="password" placeholder="Password">

    <!-- After Designation Input -->
    <label for="dob">Date of Birth</label>
    <input type="date" id="dob">

    <label for="joining_date">Date of Joining</label>
    <input type="date" id="joining_date">

    <input type="text" id="payroll_name" placeholder="Payroll Name">
    <input type="text" id="team" placeholder="Team">
    <input type="text" id="grade" placeholder="Grade">

    <div style="margin-top: 20px; text-align: center;">
      <label for="profileImageInput" style="cursor: pointer; color: #007bff; text-decoration: underline;">
        Upload Profile Image
      </label>
      <input type="file" id="profileImageInput" accept="image/*" style="display: none;" />
    </div>

    <!-- Hidden input to store base64 image string -->
    <input type="hidden" id="profileImage" />

    <br>
    <button onclick="saveEmployee()">Save Employee</button>
    <button onclick="resetForm()">Clear</button>
  </div>

  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Employee ID</th>
        <th>Designation</th>
        <th>DOB</th>
        <th>Joining Date</th>
        <th>Team</th>
        <th>Grade</th>
        <th>Actions</th>
      </tr>
    </thead>

    <tbody id="employeeTableBody"></tbody>
  </table>

<script>
  const API_URL = "https://employee-login-backend-vlfa.onrender.com/employees";

  // Format date as YYYY-MM-DD or empty string
  function formatDate(dateStr) {
    if (!dateStr) return "";
    const d = new Date(dateStr);
    return d.toISOString().split('T')[0]; // YYYY-MM-DD
  }

  // Fetch and render employee table
  function fetchEmployees() {
    fetch(API_URL)
      .then(res => {
        if (!res.ok) throw new Error("Failed to fetch employees");
        return res.json();
      })
      .then(data => {
        console.log("Fetched from DB:", data);
        const tbody = document.getElementById("employeeTableBody");
        tbody.innerHTML = "";
        data.forEach(emp => {
          const row = `
            <tr>
              <td>${emp.name}</td>
              <td>${emp.employee_id}</td>
              <td>${emp.designation}</td>
              <td>${formatDate(emp.dob)}</td>
              <td>${formatDate(emp.joining_date)}</td>
              <td>${emp.team || ""}</td>
              <td>${emp.grade || ""}</td>
              <td>
                <button class="action-btn edit" onclick="editEmployee(${emp.id})">Edit</button>
                <button class="action-btn" onclick="deleteEmployee(${emp.id})">Delete</button>
              </td>
            </tr>
          `;
          tbody.innerHTML += row;
        });
      })
      .catch(err => alert(err.message));
  }

  // Fill form to edit employee
  function editEmployee(id) {
    fetch(`${API_URL}/${id}`)
      .then(res => {
        if (!res.ok) throw new Error("Failed to fetch employee");
        return res.json();
      })
      .then(emp => {
        document.getElementById("employeeId").value = emp.id;
        document.getElementById("name").value = emp.name;
        document.getElementById("employee_id").value = emp.employee_id;
        document.getElementById("designation").value = emp.designation;
        document.getElementById("dob").value = emp.dob || "";
        document.getElementById("joining_date").value = emp.joining_date || "";
        document.getElementById("payroll_name").value = emp.payroll_name || "";
        document.getElementById("team").value = emp.team || "";
        document.getElementById("grade").value = emp.grade || "";
        document.getElementById("profileImage").value = emp.profileImage || "";
        document.getElementById("password").value = ""; // Keep empty for security
      })
      .catch(err => alert(err.message));
  }

  // Save new or edited employee
  function saveEmployee() {
    const id = document.getElementById("employeeId").value;
    const data = {
      name: document.getElementById("name").value,
      employee_id: document.getElementById("employee_id").value,
      designation: document.getElementById("designation").value,
      dob: document.getElementById("dob").value,
      joining_date: document.getElementById("joining_date").value,
      payroll_name: document.getElementById("payroll_name").value,
      team: document.getElementById("team").value,
      grade: document.getElementById("grade").value,
      profileImage: document.getElementById("profileImage").value,
      password: document.getElementById("password").value
    };

    const method = id ? "PUT" : "POST";
    const url = id ? `${API_URL}/${id}` : API_URL;

    fetch(url, {
      method,
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    })
      .then(res => {
        if (!res.ok) throw new Error("Failed to save employee");
        return res.json();
      })
      .then(() => {
        fetchEmployees();
        resetForm();
      })
      .catch(err => alert(err.message));
  }

  // Delete employee
  function deleteEmployee(id) {
    if (!confirm("Are you sure you want to delete this employee?")) return;
    fetch(`${API_URL}/${id}`, { method: "DELETE" })
      .then(res => {
        if (!res.ok) throw new Error("Failed to delete employee");
        fetchEmployees();
      })
      .catch(err => alert(err.message));
  }

  // Reset the employee form
  function resetForm() {
    document.getElementById("employeeId").value = "";
    document.getElementById("name").value = "";
    document.getElementById("employee_id").value = "";
    document.getElementById("designation").value = "";
    document.getElementById("dob").value = "";
    document.getElementById("joining_date").value = "";
    document.getElementById("payroll_name").value = "";
    document.getElementById("team").value = "";
    document.getElementById("grade").value = "";
    document.getElementById("profileImage").value = "";
    document.getElementById("password").value = "";
  }

  // Load employees on page load
  document.addEventListener("DOMContentLoaded", fetchEmployees);

  // Handle image file input and convert to base64 string
  document.getElementById('profileImageInput').addEventListener('change', function(event) {
    const file = event.target.files[0];
    if (!file) return;

    if (!file.type.startsWith('image/')) {
      alert('Please select an image file.');
      return;
    }

    const reader = new FileReader();
    reader.onload = function(e) {
      const base64Image = e.target.result;

      // Save base64 string into hidden input
      document.getElementById('profileImage').value = base64Image;

      alert('Profile image loaded. Now click Save Employee.');
    };
    reader.readAsDataURL(file);
  });

  // Optional: Go back button functionality (add this function if you want the back button to work)
  function goBack() {
    window.history.back();
  }
</script>

</body>
</html>
